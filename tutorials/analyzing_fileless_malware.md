# Analyzing Fileless Malware

## Introduction
Fileless malware resides in memory or uses legitimate system tools to avoid detection. This tutorial will guide you through the steps of detecting and analyzing fileless malware.

## Requirements
- A safe analysis environment (refer to the "Setting Up a Safe Analysis Environment" tutorial)
- Fileless malware sample (use a known harmless sample for practice)
- Tools: PowerShell logging, Event Viewer, Volatility

## Steps

### 1. Enable PowerShell Logging
1. **PowerShell Script Block Logging**: Enable script block logging to capture PowerShell commands.
   - Run the following command in PowerShell:
     ```powershell
     Set-ExecutionPolicy Unrestricted
     New-Item -Path "HKLM:\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging" -Force
     Set-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging" -Name "EnableScriptBlockLogging" -Value 1
     ```

### 2. Monitor System Activity
1. **Event Viewer**: Use Event Viewer to monitor PowerShell activity.
   - Check the "Windows PowerShell" log under "Applications and Services Logs".

2. **Process Monitor**: Use Process Monitor to track file system, registry, and process/thread activity.
   - Start Process Monitor before executing the fileless malware.
   - Filter the results to focus on PowerShell and other system processes.

### 3. Capture Memory Dump
1. **Volatility**: Use Volatility to capture and analyze the memory dump.
   - Capture a memory dump using a tool like DumpIt.
   - Analyze the memory dump with Volatility to identify suspicious processes and artifacts.

### 4. Analyze Memory Artifacts
1. **Volatility Analysis**: Use Volatility to analyze the memory dump.
   - Run basic commands to get an overview of the memory dump:
     ```sh
     volatility -f memory.dmp imageinfo
     volatility -f memory.dmp pslist
     ```

2. **Identify Suspicious Processes**: Look for suspicious processes and analyze their memory contents.
   - Use commands like `malfind` and `procdump` to locate and extract artifacts.
     ```sh
     volatility -f memory.dmp malfind
     volatility -f memory.dmp procdump -p <PID> -D output/
     ```

### 5. Document Findings
1. **Create a Report**: Document your findings, including identified processes, PowerShell commands, and memory artifacts.
2. **Screenshots and Logs**: Include screenshots of the tools and logs from your analysis.

## Conclusion
Analyzing fileless malware requires monitoring system activity and analyzing memory artifacts. By following these steps, you can detect and analyze fileless malware in a controlled environment.

## Additional Resources
- [PowerShell Logging Documentation](https://docs.microsoft.com/en-us/powershell/scripting/learn/deep-dives/everything-about-script-block-logging?view=powershell-7.1)
- [Volatility Documentation](https://volatility3.org/)
- [Event Viewer Documentation](https://docs.microsoft.com/en-us/windows/security/threat-protection/use-windows-event-forwarding-to-assist-in-intrusion-detection)

Happy analyzing!